<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - Vigyan Batch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes shimmer { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }
        .animate-slide-in { animation: slideIn 0.5s ease-out; }
        .animate-pulse-slow { animation: pulse 2s infinite; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .notification-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .notification-card:hover { transform: translateY(-4px) scale(1.01); box-shadow: 0 20px 40px rgba(139, 92, 246, 0.2); }
        .filter-btn.active { background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; }
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 1000px 100%; animation: shimmer 2s infinite; }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-indigo-100 min-h-screen">
    <nav class="fixed top-0 w-full z-50 bg-white/90 backdrop-blur-md shadow-lg border-b border-purple-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 h-16 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg flex items-center justify-center animate-pulse-slow">
                    <i class="fas fa-bell text-white"></i>
                </div>
                <span class="text-xl sm:text-2xl font-bold bg-gradient-to-r from-purple-600 to-purple-800 bg-clip-text text-transparent">Vigyan Notifications</span>
            </div>
            <a href="vigyan.html" class="flex items-center space-x-2 px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-all duration-300 hover:scale-105">
                <i class="fas fa-arrow-left"></i>
                <span class="hidden sm:inline">Back to Batch</span>
            </a>
        </div>
    </nav>

    <div class="pt-20 pb-8">
        <div class="max-w-6xl mx-auto px-4 sm:px-6">
            <div class="text-center mb-8 animate-slide-in">
                <h1 class="text-3xl sm:text-4xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent mb-2">Notifications Center</h1>
                <p class="text-gray-600 mb-6">Stay updated with the latest announcements</p>
                
                <!-- Search & Actions -->
                <div class="flex flex-col sm:flex-row gap-3 justify-center items-center mb-6">
                    <div class="relative w-full sm:w-96">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="search-input" placeholder="Search notifications..." class="w-full pl-12 pr-4 py-3 rounded-xl border-2 border-purple-200 focus:border-purple-500 focus:outline-none transition-all">
                    </div>
                    <button onclick="markAllAsRead()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl hover:shadow-lg transition-all duration-300 hover:scale-105">
                        <i class="fas fa-check-double mr-2"></i>Clear All
                    </button>
                </div>

                <!-- Filters -->
                <div class="flex flex-wrap gap-2 justify-center mb-6">
                    <button onclick="filterNotifications('all')" class="filter-btn active px-4 py-2 rounded-full border-2 border-purple-300 transition-all duration-300 hover:scale-105" data-filter="all">
                        <i class="fas fa-list mr-2"></i>All
                    </button>
                    <button onclick="filterNotifications('urgent')" class="filter-btn px-4 py-2 rounded-full border-2 border-purple-300 transition-all duration-300 hover:scale-105" data-filter="urgent">
                        <i class="fas fa-exclamation-circle mr-2"></i>Urgent
                    </button>
                    <button onclick="filterNotifications('assignment')" class="filter-btn px-4 py-2 rounded-full border-2 border-purple-300 transition-all duration-300 hover:scale-105" data-filter="assignment">
                        <i class="fas fa-tasks mr-2"></i>Assignments
                    </button>
                    <button onclick="filterNotifications('exam')" class="filter-btn px-4 py-2 rounded-full border-2 border-purple-300 transition-all duration-300 hover:scale-105" data-filter="exam">
                        <i class="fas fa-graduation-cap mr-2"></i>Exams
                    </button>
                    <button onclick="filterNotifications('announcement')" class="filter-btn px-4 py-2 rounded-full border-2 border-purple-300 transition-all duration-300 hover:scale-105" data-filter="announcement">
                        <i class="fas fa-bullhorn mr-2"></i>Announcements
                    </button>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl p-4 shadow-lg">
                        <div class="text-2xl font-bold text-purple-600" id="total-count">0</div>
                        <div class="text-sm text-gray-600">Total</div>
                    </div>
                    <div class="bg-white rounded-xl p-4 shadow-lg">
                        <div class="text-2xl font-bold text-red-600" id="urgent-count">0</div>
                        <div class="text-sm text-gray-600">Urgent</div>
                    </div>
                    <div class="bg-white rounded-xl p-4 shadow-lg">
                        <div class="text-2xl font-bold text-blue-600" id="today-count">0</div>
                        <div class="text-sm text-gray-600">Today</div>
                    </div>
                    <div class="bg-white rounded-xl p-4 shadow-lg">
                        <div class="text-2xl font-bold text-green-600" id="week-count">0</div>
                        <div class="text-sm text-gray-600">This Week</div>
                    </div>
                </div>
            </div>
            <div id="notifications-container" class="space-y-4">
                <div class="flex justify-center items-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCDZJeZeJPkuDUZ5Vf_-rsy0PQsx8tQw4k",
            authDomain: "quiz-app-10f81.firebaseapp.com",
            databaseURL: "https://quiz-app-10f81-default-rtdb.firebaseio.com",
            projectId: "quiz-app-10f81",
            storageBucket: "quiz-app-10f81.firebasestorage.app",
            messagingSenderId: "351578019731",
            appId: "1:351578019731:web:2055fe24498ca17908fa66"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let allNotifications = [];
        let currentFilter = 'all';

        function getCategoryIcon(category) {
            const icons = {
                'assignment': 'fa-tasks',
                'exam': 'fa-graduation-cap',
                'announcement': 'fa-bullhorn',
                'event': 'fa-calendar',
                'reminder': 'fa-clock'
            };
            return icons[category] || 'fa-bell';
        }

        function getCategoryColor(category) {
            const colors = {
                'assignment': 'blue',
                'exam': 'red',
                'announcement': 'purple',
                'event': 'green',
                'reminder': 'yellow'
            };
            return colors[category] || 'purple';
        }

        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            return new Date(timestamp).toLocaleDateString();
        }

        function updateStats() {
            const now = Date.now();
            const today = new Date().setHours(0,0,0,0);
            const weekAgo = now - 7 * 24 * 60 * 60 * 1000;
            
            document.getElementById('total-count').textContent = allNotifications.length;
            document.getElementById('urgent-count').textContent = allNotifications.filter(n => n.urgent).length;
            document.getElementById('today-count').textContent = allNotifications.filter(n => n.timestamp >= today).length;
            document.getElementById('week-count').textContent = allNotifications.filter(n => n.timestamp >= weekAgo).length;
        }

        function renderNotifications(notifications) {
            const container = document.getElementById('notifications-container');
            container.innerHTML = '';

            if (notifications.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-16 animate-fade-in">
                        <div class="w-24 h-24 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-bell-slash text-4xl text-purple-400"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">No notifications found</h3>
                        <p class="text-gray-500">You're all caught up!</p>
                    </div>
                `;
                return;
            }

            notifications.forEach((notification, index) => {
                const category = notification.category || 'announcement';
                const color = getCategoryColor(category);
                const icon = getCategoryIcon(category);
                const urgentClass = notification.urgent ? 'border-red-500 bg-gradient-to-r from-red-50 to-pink-50' : `border-${color}-500 bg-white`;
                
                const notificationEl = document.createElement('div');
                notificationEl.style.animationDelay = `${index * 0.05}s`;
                notificationEl.className = `notification-card rounded-2xl shadow-xl p-6 border-l-4 ${urgentClass} animate-slide-in`;
                notificationEl.innerHTML = `
                    <div class="flex items-start justify-between gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-14 h-14 bg-gradient-to-br from-${color}-400 to-${color}-600 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas ${icon} text-2xl text-white"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between gap-2 mb-2">
                                <h3 class="text-xl font-bold text-gray-900">${notification.title}</h3>
                                ${notification.urgent ? '<span class="px-3 py-1 bg-red-500 text-white text-xs rounded-full font-bold animate-pulse">URGENT</span>' : ''}
                            </div>
                            <p class="text-gray-700 mb-4 leading-relaxed">${notification.message}</p>
                            <div class="flex flex-wrap items-center gap-4 text-sm">
                                <span class="flex items-center gap-2 text-gray-600">
                                    <i class="fas fa-clock text-${color}-500"></i>
                                    <span class="font-medium">${getTimeAgo(notification.timestamp)}</span>
                                </span>
                                <span class="flex items-center gap-2 text-gray-600">
                                    <i class="fas fa-user text-${color}-500"></i>
                                    <span class="font-medium">${notification.createdBy}</span>
                                </span>
                                <span class="px-3 py-1 bg-${color}-100 text-${color}-700 rounded-full text-xs font-semibold capitalize">
                                    ${category}
                                </span>
                            </div>
                        </div>
                        <button onclick="markAsRead('${notification.id}')" class="flex-shrink-0 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl hover:shadow-lg transition-all duration-300 hover:scale-105 flex items-center gap-2">
                            <i class="fas fa-check"></i>
                            <span class="hidden sm:inline">Done</span>
                        </button>
                    </div>
                `;
                container.appendChild(notificationEl);
            });
        }

        function filterNotifications(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
            
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            let filtered = allNotifications;
            
            if (filter !== 'all') {
                if (filter === 'urgent') {
                    filtered = filtered.filter(n => n.urgent);
                } else {
                    filtered = filtered.filter(n => n.category === filter);
                }
            }
            
            if (searchTerm) {
                filtered = filtered.filter(n => 
                    n.title.toLowerCase().includes(searchTerm) || 
                    n.message.toLowerCase().includes(searchTerm)
                );
            }
            
            renderNotifications(filtered);
        }

        document.getElementById('search-input').addEventListener('input', () => {
            filterNotifications(currentFilter);
        });

        function loadNotifications() {
            database.ref('notifications/vigyan').orderByChild('timestamp').on('value', (snapshot) => {
                const container = document.getElementById('notifications-container');
                container.innerHTML = '';

                if (!snapshot.exists()) {
                    container.innerHTML = '<p class="text-gray-500 text-center">No notifications yet</p>';
                    return;
                }

                allNotifications = [];
                snapshot.forEach((child) => {
                    const notificationData = child.val();
                    notificationData.id = child.key;
                    allNotifications.push(notificationData);
                });

                allNotifications.reverse();
                updateStats();
                filterNotifications(currentFilter);
            });
        }

        loadNotifications();
        
        function markAsRead(notificationId) {
            const notification = document.querySelector(`button[onclick="markAsRead('${notificationId}')"]`).closest('.notification-card');
            notification.style.transform = 'scale(0.95)';
            notification.style.opacity = '0.5';
            
            setTimeout(() => {
                database.ref(`notifications/vigyan/${notificationId}`).remove()
                    .then(() => {
                        console.log('Notification marked as read');
                    })
                    .catch((error) => {
                        console.error('Error marking notification as read:', error);
                        notification.style.transform = '';
                        notification.style.opacity = '';
                    });
            }, 300);
        }
        
        function markAllAsRead() {
            if (!confirm('Clear all notifications? This cannot be undone.')) return;
            
            const container = document.getElementById('notifications-container');
            container.style.opacity = '0.5';
            
            database.ref('notifications/vigyan').remove()
                .then(() => {
                    console.log('All notifications cleared');
                    container.style.opacity = '1';
                })
                .catch((error) => {
                    console.error('Error clearing notifications:', error);
                    container.style.opacity = '1';
                    alert('Failed to clear notifications. Please try again.');
                });
        }
    </script>
</body>
</html>