<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Messages - Padhle Champs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        * { font-family: 'Inter', sans-serif; }
        .font-poppins { font-family: 'Poppins', sans-serif; }
        
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-text { background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        .message-card {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        
        .message-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.12);
            border-color: rgba(102, 126, 234, 0.3);
        }
        
        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .status-pending {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        
        .status-replied {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }
        .animate-slide-up { animation: slideUp 0.8s ease-out forwards; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        .floating-icon { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        
        .pulse-ring { animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite; }
        @keyframes pulse-ring { 0% { transform: scale(0.33); } 80%, 100% { opacity: 0; } }
        
        .search-input:focus { box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        
        @media (max-width: 640px) {
            .message-card:hover { transform: none; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen">
    <!-- Background Pattern -->
    <div class="fixed inset-0 opacity-5 pointer-events-none">
        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#667eea" stroke-width="1"/>
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#grid)"/>
        </svg>
    </div>

    <div class="relative min-h-screen py-6 sm:py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <!-- Header Section -->
            <div class="glass-effect rounded-3xl shadow-2xl p-6 sm:p-8 mb-8 sm:mb-12 animate-fade-in">
                <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6">
                    <div class="flex items-center gap-4 sm:gap-6">
                        <div class="relative">
                            <div class="w-16 h-16 sm:w-20 sm:h-20 gradient-bg rounded-2xl flex items-center justify-center shadow-xl floating-icon">
                                <svg class="w-8 h-8 sm:w-10 sm:h-10 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 8L10.89 13.26C11.2187 13.4793 11.6049 13.5963 12 13.5963C12.3951 13.5963 12.7813 13.4793 13.11 13.26L21 8M5 19H19C19.5304 19 20.0391 18.7893 20.4142 18.4142C20.7893 18.0391 21 17.5304 21 17V7C21 6.46957 20.7893 5.96086 20.4142 5.58579C20.0391 5.21071 19.5304 5 19 5H5C4.46957 5 3.96086 5.21071 3.58579 5.58579C3.21071 5.96086 3 6.46957 3 7V17C3 17.5304 3.21071 18.0391 3.58579 18.4142C3.96086 18.7893 4.46957 19 5 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="absolute -inset-2 gradient-bg rounded-2xl opacity-20 pulse-ring"></div>
                        </div>
                        <div>
                            <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold gradient-text font-poppins mb-2">Student Messages Hub</h1>
                            <p class="text-sm sm:text-base lg:text-lg text-slate-600 font-medium">Manage and respond to student inquiries with ease</p>
                            <div class="flex items-center gap-2 mt-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                <span class="text-xs sm:text-sm text-slate-500 font-medium">Real-time updates</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4">
                        <div class="flex items-center gap-3 bg-white/60 backdrop-blur-sm rounded-xl px-4 py-3 border border-white/30">
                            <svg class="w-5 h-5 text-slate-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2C13.1046 2 14 2.89543 14 4V6C14 7.10457 13.1046 8 12 8C10.8954 8 10 7.10457 10 6V4C10 2.89543 10.8954 2 12 2Z" fill="currentColor"/>
                                <path d="M20.485 4.929L19.071 6.343L17.657 4.929C17.2665 4.53848 16.6333 4.53848 16.2428 4.929C15.8523 5.31953 15.8523 5.95269 16.2428 6.343L17.657 7.757L16.2428 9.171C15.8523 9.56153 15.8523 10.1947 16.2428 10.5852C16.6333 10.9757 17.2665 10.9757 17.657 10.5852L19.071 9.171L20.485 10.5852C20.8755 10.9757 21.5087 10.9757 21.8992 10.5852C22.2897 10.1947 22.2897 9.56153 21.8992 9.171L20.485 7.757L21.8992 6.343C22.2897 5.95269 22.2897 5.31953 21.8992 4.929C21.5087 4.53848 20.8755 4.53848 20.485 4.929Z" fill="currentColor"/>
                            </svg>
                            <span class="text-sm font-semibold text-slate-700" id="messageCount">Loading...</span>
                        </div>
                        <button onclick="window.history.back()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold text-sm sm:text-base flex items-center justify-center gap-2 border-0">
                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Back to Dashboard
                        </button>
                    </div>
                </div>
            </div>

            <!-- Filter & Search Section -->
            <div class="glass-effect rounded-2xl shadow-xl p-4 sm:p-6 mb-8 animate-slide-up">
                <div class="flex flex-col lg:flex-row gap-4 lg:gap-6">
                    <div class="flex-1">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Filter by Status</label>
                        <div class="relative">
                            <select id="statusFilter" class="w-full px-4 py-3 bg-white/80 border border-slate-200 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400 transition-all text-sm sm:text-base font-medium">
                                <option value="all">üîç All Messages</option>
                                <option value="pending">‚è≥ Pending Only</option>
                                <option value="replied">‚úÖ Replied Only</option>
                            </select>
                            <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="flex-2 lg:flex-1">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Search Messages</label>
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Search by student name or subject..." 
                                   class="w-full px-4 py-3 pl-12 bg-white/80 border border-slate-200 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400 transition-all text-sm sm:text-base search-input">
                            <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                                <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages Container -->
            <div id="messagesContainer" class="space-y-6 sm:space-y-8">
                <div class="text-center py-16">
                    <div class="relative inline-block">
                        <svg class="w-16 h-16 sm:w-20 sm:h-20 text-indigo-300 animate-spin" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-dasharray="31.416" stroke-dashoffset="31.416">
                                <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
                                <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
                            </circle>
                        </svg>
                    </div>
                    <h3 class="text-xl sm:text-2xl font-bold text-slate-600 mt-6 mb-2 font-poppins">Loading Messages</h3>
                    <p class="text-slate-500">Please wait while we fetch your student messages...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Reply Modal -->
    <div id="replyModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-3xl p-6 sm:p-8 max-w-3xl w-full max-h-[90vh] overflow-y-auto shadow-2xl animate-slide-up">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 20L21 4M21 4H7M21 4V18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h3 class="text-xl sm:text-2xl font-bold gradient-text font-poppins">Reply to Student</h3>
                </div>
                <button onclick="closeReplyModal()" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-xl flex items-center justify-center transition-colors">
                    <svg class="w-5 h-5 text-slate-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            
            <div id="originalMessage" class="bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 p-4 sm:p-6 rounded-2xl mb-6"></div>
            
            <div class="mb-6">
                <label class="block text-sm font-semibold text-slate-700 mb-3">Your Response</label>
                <textarea id="replyText" rows="6" placeholder="Type your thoughtful reply here..." 
                          class="w-full px-4 py-4 bg-white/80 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400 transition-all text-sm sm:text-base resize-none"></textarea>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
                <button onclick="closeReplyModal()" class="flex-1 px-6 py-3 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-xl font-semibold transition-colors text-sm sm:text-base">
                    Cancel
                </button>
                <button onclick="sendReply()" class="flex-1 btn-primary text-white px-6 py-3 rounded-xl font-semibold border-0 text-sm sm:text-base flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Send Reply
                </button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCDZJeZeJPkuDUZ5Vf_-rsy0PQsx8tQw4k",
            authDomain: "quiz-app-10f81.firebaseapp.com",
            databaseURL: "https://quiz-app-10f81-default-rtdb.firebaseio.com",
            projectId: "quiz-app-10f81",
            storageBucket: "quiz-app-10f81.firebasestorage.app",
            messagingSenderId: "351578019731",
            appId: "1:351578019731:web:2055fe24498ca17908fa66"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let allMessages = [];
        let currentReplyMessageId = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadMessages();
            document.getElementById('statusFilter').addEventListener('change', filterMessages);
            document.getElementById('searchInput').addEventListener('input', filterMessages);
        });

        async function loadMessages() {
            try {
                const snapshot = await database.ref('contactMessages').once('value');
                allMessages = [];
                
                snapshot.forEach(child => {
                    allMessages.push({ id: child.key, ...child.val() });
                });

                allMessages.sort((a, b) => b.timestamp - a.timestamp);
                updateMessageCount();
                displayMessages(allMessages);
            } catch (error) {
                console.error('Error loading messages:', error);
                showErrorState();
            }
        }

        function updateMessageCount() {
            const pendingCount = allMessages.filter(m => m.status !== 'replied').length;
            const totalCount = allMessages.length;
            document.getElementById('messageCount').textContent = `${pendingCount} pending of ${totalCount} total`;
        }

        function displayMessages(messages) {
            const container = document.getElementById('messagesContainer');
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-20">
                        <div class="relative inline-block mb-8">
                            <svg class="w-24 h-24 text-slate-300" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="currentColor" stroke-width="2"/>
                                <path d="M8 12H16M12 8V16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <h3 class="text-2xl sm:text-3xl font-bold text-slate-600 mb-4 font-poppins">No Messages Found</h3>
                        <p class="text-slate-500 text-lg">No student messages match your current filters.</p>
                        <button onclick="resetFilters()" class="mt-6 btn-primary text-white px-6 py-3 rounded-xl font-semibold border-0">
                            Reset Filters
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = messages.map((message, index) => `
                <div class="message-card p-6 sm:p-8 animate-slide-up" style="animation-delay: ${index * 0.1}s">
                    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-start mb-6 gap-4">
                        <div class="flex items-start gap-4 sm:gap-6 flex-1 min-w-0">
                            <div class="relative flex-shrink-0">
                                <div class="w-14 h-14 sm:w-16 sm:h-16 gradient-bg rounded-2xl flex items-center justify-center shadow-lg">
                                    <span class="text-white font-bold text-lg sm:text-xl font-poppins">${message.studentName.charAt(0).toUpperCase()}</span>
                                </div>
                                <div class="absolute -bottom-1 -right-1 w-5 h-5 ${message.status === 'replied' ? 'bg-green-500' : 'bg-amber-500'} rounded-full border-2 border-white"></div>
                            </div>
                            <div class="min-w-0 flex-1">
                                <h3 class="text-lg sm:text-xl font-bold text-slate-900 mb-1 font-poppins truncate">${message.subject}</h3>
                                <p class="text-sm sm:text-base text-slate-600 font-medium mb-2">From: ${message.studentName}</p>
                                <div class="flex items-center gap-2 text-xs sm:text-sm text-slate-500">
                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                        <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    ${new Date(message.timestamp).toLocaleString()}
                                </div>
                            </div>
                        </div>
                        <span class="px-4 py-2 text-xs sm:text-sm rounded-xl font-bold flex-shrink-0 ${
                            message.status === 'replied' ? 'status-replied' : 'status-pending'
                        }">
                            ${message.status === 'replied' ? '‚úÖ Replied' : '‚è≥ Pending'}
                        </span>
                    </div>
                    
                    <div class="bg-gradient-to-r from-slate-50 to-slate-100 border border-slate-200 p-4 sm:p-6 rounded-2xl mb-6">
                        <div class="flex items-center gap-2 mb-3">
                            <svg class="w-5 h-5 text-slate-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span class="font-semibold text-slate-700">Student Message</span>
                        </div>
                        <p class="text-sm sm:text-base text-slate-800 leading-relaxed break-words">${message.message}</p>
                    </div>
                    
                    ${message.reply ? `
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-500 p-4 sm:p-6 rounded-2xl mb-6">
                            <div class="flex items-center gap-2 mb-3">
                                <svg class="w-5 h-5 text-green-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 20L21 4M21 4H7M21 4V18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span class="font-semibold text-green-800">Your Reply</span>
                                <span class="text-xs text-slate-500 ml-auto">${new Date(message.replyTimestamp).toLocaleString()}</span>
                            </div>
                            <p class="text-sm sm:text-base text-slate-800 leading-relaxed break-words">${message.reply}</p>
                        </div>
                    ` : ''}
                    
                    <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
                        ${!message.reply ? `
                            <button onclick="openReplyModal('${message.id}')" 
                                    class="flex-1 btn-primary text-white px-6 py-3 rounded-xl font-semibold border-0 text-sm sm:text-base flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 20L21 4M21 4H7M21 4V18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Reply to Student
                            </button>
                        ` : `
                            <button onclick="openReplyModal('${message.id}')" 
                                    class="flex-1 btn-success text-white px-6 py-3 rounded-xl font-semibold border-0 text-sm sm:text-base flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M18.5 2.5C18.8978 2.10217 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10217 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10217 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Update Reply
                            </button>
                        `}
                        <button onclick="deleteMessage('${message.id}')" 
                                class="flex-1 sm:flex-none btn-danger text-white px-6 py-3 rounded-xl font-semibold border-0 text-sm sm:text-base flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <polyline points="3,6 5,6 21,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterMessages() {
            const statusFilter = document.getElementById('statusFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let filtered = allMessages.filter(message => {
                const matchesStatus = statusFilter === 'all' || message.status === statusFilter;
                const matchesSearch = message.studentName.toLowerCase().includes(searchTerm) ||
                                    message.subject.toLowerCase().includes(searchTerm) ||
                                    message.message.toLowerCase().includes(searchTerm);
                return matchesStatus && matchesSearch;
            });
            
            displayMessages(filtered);
        }

        function resetFilters() {
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('searchInput').value = '';
            displayMessages(allMessages);
        }

        function openReplyModal(messageId) {
            const message = allMessages.find(m => m.id === messageId);
            if (!message) return;
            
            currentReplyMessageId = messageId;
            document.getElementById('originalMessage').innerHTML = `
                <div class="flex items-center gap-3 mb-4">
                    <svg class="w-5 h-5 text-slate-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <h4 class="font-bold text-slate-800 font-poppins">Original Message from ${message.studentName}</h4>
                </div>
                <p class="text-slate-700 leading-relaxed">${message.message}</p>
            `;
            
            document.getElementById('replyText').value = message.reply || '';
            document.getElementById('replyModal').classList.remove('hidden');
        }

        function closeReplyModal() {
            document.getElementById('replyModal').classList.add('hidden');
            currentReplyMessageId = null;
        }

        async function sendReply() {
            const replyText = document.getElementById('replyText').value.trim();
            if (!replyText || !currentReplyMessageId) {
                alert('Please enter a reply message.');
                return;
            }
            
            try {
                await database.ref(`contactMessages/${currentReplyMessageId}`).update({
                    reply: replyText,
                    replyTimestamp: Date.now(),
                    status: 'replied'
                });
                
                showSuccessMessage('Reply sent successfully!');
                closeReplyModal();
                loadMessages();
            } catch (error) {
                console.error('Error sending reply:', error);
                alert('Error sending reply. Please try again.');
            }
        }

        async function deleteMessage(messageId) {
            if (!confirm('Are you sure you want to delete this message? This action cannot be undone.')) return;
            
            try {
                await database.ref(`contactMessages/${messageId}`).remove();
                showSuccessMessage('Message deleted successfully!');
                loadMessages();
            } catch (error) {
                console.error('Error deleting message:', error);
                alert('Error deleting message. Please try again.');
            }
        }

        function showSuccessMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-xl shadow-lg z-50 animate-slide-up';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function showErrorState() {
            document.getElementById('messagesContainer').innerHTML = `
                <div class="text-center py-20">
                    <svg class="w-24 h-24 text-red-300 mx-auto mb-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                        <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
                        <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <h3 class="text-2xl font-bold text-slate-600 mb-4 font-poppins">Error Loading Messages</h3>
                    <p class="text-slate-500 mb-6">There was an error loading the messages. Please try again.</p>
                    <button onclick="loadMessages()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold border-0">
                        Try Again
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>