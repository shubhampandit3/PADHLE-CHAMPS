<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Teacher Analysis - Padhle Champs</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * { font-family: 'Inter', sans-serif; }
        .font-poppins { font-family: 'Poppins', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%); }
        .gradient-text { background: linear-gradient(135deg, #6366f1, #8b5cf6, #d946ef); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .card-shadow { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(255, 255, 255, 0.05); }
        .glass-effect { backdrop-filter: blur(16px); background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); }
        .fade-in { animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards; opacity: 0; }
        .slide-up { animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeIn { to { opacity: 1; } }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }
        .hover-lift { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 32px 64px -12px rgba(0, 0, 0, 0.12); }
        .icon-bounce { animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); } 40%, 43% { transform: translate3d(0, -8px, 0); } 70% { transform: translate3d(0, -4px, 0); } 90% { transform: translate3d(0, -2px, 0); } }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .hover-lift:hover { transform: none; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08); }
            .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
            .mobile-table { font-size: 0.75rem; }
            .mobile-table th, .mobile-table td { padding: 0.5rem 0.25rem; }
            .mobile-hidden { display: none !important; }
            .mobile-text-xs { font-size: 0.625rem; }
            .mobile-p-2 { padding: 0.5rem; }
            .mobile-mb-4 { margin-bottom: 1rem; }
        }
        
        @media (max-width: 480px) {
            .stat-grid { grid-template-columns: 1fr; }
            .mobile-table { font-size: 0.7rem; }
            .mobile-table .stat-icon { width: 2.5rem; height: 2.5rem; }
            .mobile-table .stat-number { font-size: 1.25rem; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <nav class="gradient-bg shadow-2xl relative overflow-hidden">
        <div class="absolute inset-0 bg-black bg-opacity-10"></div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 mr-2 sm:mr-4 icon-bounce">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full text-white">
                            <path d="M3 3V21L12 17L21 21V3H3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="currentColor" fill-opacity="0.2"/>
                            <path d="M9 9L15 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M9 13L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <span class="text-lg sm:text-2xl font-bold text-white font-poppins tracking-tight">Test Analysis Hub</span>
                </div>
                <div class="flex items-center space-x-2 sm:space-x-6">
                    <a href="home.html" class="glass-effect px-2 sm:px-4 py-2 rounded-xl text-white hover:bg-white hover:bg-opacity-20 transition-all duration-300 flex items-center">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5 sm:mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="hidden sm:inline">Home</span>
                    </a>
                    <div class="glass-effect px-2 sm:px-4 py-2 rounded-xl flex items-center">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5 sm:mr-2 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="font-semibold text-white text-sm sm:text-base" id="username">Teacher</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Test Selection -->
        <div class="bg-white rounded-3xl card-shadow p-6 sm:p-8 mb-8 sm:mb-10 fade-in hover-lift">
            <div class="flex items-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center mr-4">
                    <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 11H15M9 15H15M17 21L12 16L7 21V5C7 4.46957 7.21071 3.96086 7.58579 3.58579C7.96086 3.21071 8.46957 3 9 3H15C15.5304 3 16.0391 3.21071 16.4142 3.58579C16.7893 3.96086 17 4.46957 17 5V21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h1 class="text-2xl sm:text-3xl font-bold gradient-text font-poppins">Select Test for Analysis</h1>
            </div>
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center space-y-4 sm:space-y-0 sm:space-x-6">
                <div class="flex-1 relative">
                    <select id="testSelector" class="w-full px-4 sm:px-6 py-3 sm:py-4 border-2 border-gray-200 rounded-2xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all duration-300 text-sm sm:text-base font-medium bg-gray-50 hover:bg-white">
                        <option value="">ðŸŽ¯ Select a test to analyze...</option>
                    </select>
                    <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                <button onclick="loadTestAnalysis()" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-2xl hover:from-indigo-700 hover:to-purple-700 transition-all duration-300 font-semibold text-sm sm:text-base shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                        <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Analyze Test
                </button>
            </div>
        </div>

        <!-- Test Overview -->
        <div class="bg-white rounded-3xl card-shadow p-6 sm:p-8 mb-8 sm:mb-10 slide-up hover-lift" id="testOverview" style="display: none;">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 sm:mb-8">
                <div class="flex items-center mb-4 sm:mb-0">
                    <div class="w-10 h-10 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center mr-3">
                        <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-900 font-poppins" id="selectedTestTitle">Test Analysis</h2>
                </div>
                <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-6">
                    <div class="flex items-center text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg">
                        <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                            <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
                            <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
                            <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span id="testDate">Date: -</span>
                    </div>
                    <div class="flex items-center text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg">
                        <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span id="testDuration">Duration: -</span>
                    </div>
                </div>
            </div>
            
            <div class="stat-grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 lg:gap-8">
                <div class="text-center group">
                    <div class="stat-icon w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                            <path d="M23 21V19C23 18.1645 22.7155 17.3541 22.2094 16.6977C21.7033 16.0414 20.9999 15.5766 20.2 15.3746" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 3.13C16.8003 3.33204 17.5037 3.79668 18.0098 4.45302C18.5159 5.10936 18.8004 5.91973 18.8004 6.755C18.8004 7.59027 18.5159 8.40064 18.0098 9.05698C17.5037 9.71332 16.8003 10.178 16 10.38" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="stat-number text-2xl sm:text-3xl font-bold text-blue-600 font-poppins mb-1" id="totalStudents">0</div>
                    <div class="text-xs sm:text-sm font-medium text-gray-600">Total Students</div>
                </div>
                <div class="text-center group">
                    <div class="stat-icon w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.7088 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4905 2.02168 11.3363C2.16356 9.18203 2.99721 7.13214 4.39828 5.49883C5.79935 3.86553 7.69279 2.72636 9.79619 2.24223C11.8996 1.75809 14.1003 1.95185 16.07 2.79" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <polyline points="22,4 12,14.01 9,11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="stat-number text-2xl sm:text-3xl font-bold text-emerald-600 font-poppins mb-1" id="liveAttempts">0</div>
                    <div class="text-xs sm:text-sm font-medium text-gray-600">LIVE Attempts</div>
                </div>
                <div class="text-center group">
                    <div class="stat-icon w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
                            <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="stat-number text-2xl sm:text-3xl font-bold text-red-600 font-poppins mb-1" id="nonLiveAttempts">0</div>
                    <div class="text-xs sm:text-sm font-medium text-gray-600">NON-LIVE Attempts</div>
                </div>
                <div class="text-center group">
                    <div class="stat-icon w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <polyline points="23,4 23,10 17,10" stroke="currentColor" stroke-width="2"/>
                            <polyline points="1,20 1,14 7,14" stroke="currentColor" stroke-width="2"/>
                            <path d="M20.49 9C19.9828 7.56678 19.1209 6.28392 17.9845 5.27304C16.8482 4.26216 15.4745 3.55682 13.9917 3.21834C12.5089 2.87986 10.9652 2.91902 9.50481 3.33329C8.04437 3.74755 6.70481 4.52327 5.60429 5.59" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M3.51001 15C4.01716 16.4332 4.87906 17.7161 6.01547 18.727C7.15189 19.7378 8.52547 20.4432 10.0083 20.7817C11.4911 21.1201 13.0348 21.081 14.4952 20.6667C15.9556 20.2525 17.2952 19.4767 18.3957 18.41" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="stat-number text-2xl sm:text-3xl font-bold text-purple-600 font-poppins mb-1" id="totalReattempts">0</div>
                    <div class="text-xs sm:text-sm font-medium text-gray-600">Total Reattempts</div>
                </div>
            </div>
        </div>

        <!-- Student Performance Table -->
        <div class="bg-white rounded-3xl card-shadow p-6 sm:p-8 slide-up hover-lift" id="studentPerformance" style="display: none;">
            <div class="flex items-center mb-6 sm:mb-8">
                <div class="w-10 h-10 bg-gradient-to-r from-amber-500 to-orange-600 rounded-xl flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 4V10C16 10.5304 16.2107 11.0391 16.5858 11.4142C16.9609 11.7893 17.4696 12 18 12H22M6 2C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V8L16 4H6Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 13H16M8 17H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </div>
                <h2 class="text-xl sm:text-2xl font-bold gradient-text font-poppins">Student Performance Analysis</h2>
            </div>
            <div class="overflow-x-auto rounded-2xl border border-gray-100">
                <table class="mobile-table w-full min-w-[800px]">
                    <thead>
                        <tr class="bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200">
                            <th class="text-left py-2 sm:py-4 px-3 sm:px-6 font-bold text-gray-800 text-xs sm:text-base font-poppins">
                                <div class="flex items-center">
                                    <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-gray-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    <span class="hidden sm:inline">Student</span>
                                    <span class="sm:hidden">Name</span>
                                </div>
                            </th>
                            <th class="text-center py-2 sm:py-4 px-2 sm:px-4 font-bold text-gray-800 text-xs sm:text-base font-poppins">
                                <div class="flex items-center justify-center">
                                    <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-gray-600 mobile-hidden" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span class="hidden sm:inline">Attempts</span>
                                    <span class="sm:hidden">Att</span>
                                </div>
                            </th>
                            <th class="text-center py-4 px-4 font-bold text-gray-800 text-sm sm:text-base font-poppins">
                                <div class="flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-2 text-emerald-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <polyline points="22,12 18,12 15,21 9,3 6,12 2,12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Best
                                </div>
                            </th>
                            <th class="text-center py-4 px-4 font-bold text-gray-800 text-sm sm:text-base font-poppins">
                                <div class="flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-2 text-red-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <polyline points="22,12 18,12 15,21 9,3 6,12 2,12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Lowest
                                </div>
                            </th>
                            <th class="text-center py-4 px-4 font-bold text-gray-800 text-sm sm:text-base font-poppins">
                                <div class="flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-2 text-blue-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <polyline points="22,12 18,12 15,21 9,3 6,12 2,12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Latest
                                </div>
                            </th>
                            <th class="text-center py-4 px-4 font-bold text-gray-800 text-sm sm:text-base font-poppins">
                                <div class="flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-2 text-gray-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                        <path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    Status
                                </div>
                            </th>
                            <th class="text-center py-4 px-4 font-bold text-gray-800 text-sm sm:text-base font-poppins">
                                <div class="flex items-center justify-center">
                                    <svg class="w-4 h-4 mr-2 text-amber-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    XP
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody" class="divide-y divide-gray-100">
                        <!-- Student data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCDZJeZeJPkuDUZ5Vf_-rsy0PQsx8tQw4k",
            authDomain: "quiz-app-10f81.firebaseapp.com",
            databaseURL: "https://quiz-app-10f81-default-rtdb.firebaseio.com",
            projectId: "quiz-app-10f81",
            storageBucket: "quiz-app-10f81.firebasestorage.app",
            messagingSenderId: "351578019731",
            appId: "1:351578019731:web:2055fe24498ca17908fa66"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let allTests = [];
        let selectedTestData = null;

        document.addEventListener('DOMContentLoaded', function() {
            const userData = JSON.parse(localStorage.getItem('padhleChamps_user'));
            if (userData) {
                document.getElementById('username').textContent = userData.name.split(' ')[0];
                if (userData.role !== 'Teacher' && userData.role !== 'teacher') {
                    alert('Access denied. Teachers only.');
                    window.location.href = 'home.html';
                    return;
                }
            } else {
                alert('Please login first');
                window.location.href = 'login.html';
                return;
            }

            loadAllTests();
        });

        async function loadAllTests() {
            try {
                const testsSnapshot = await database.ref('tests').once('value');
                allTests = [];
                
                testsSnapshot.forEach(childSnapshot => {
                    const test = childSnapshot.val();
                    test.id = childSnapshot.key;
                    allTests.push(test);
                });

                populateTestSelector();
            } catch (error) {
                console.error('Error loading tests:', error);
                alert('Error loading tests');
            }
        }

        function populateTestSelector() {
            const selector = document.getElementById('testSelector');
            selector.innerHTML = '<option value="">ðŸŽ¯ Select a test to analyze...</option>';
            
            allTests.forEach(test => {
                const option = document.createElement('option');
                option.value = test.id;
                option.textContent = `ðŸ“ ${test.title} (${new Date(test.createdAt).toLocaleDateString()})`;
                selector.appendChild(option);
            });
        }

        async function loadTestAnalysis() {
            const testId = document.getElementById('testSelector').value;
            if (!testId) {
                alert('Please select a test');
                return;
            }

            selectedTestData = allTests.find(test => test.id === testId);
            if (!selectedTestData) {
                alert('Test not found');
                return;
            }

            try {
                // Load all results for this test
                const resultsSnapshot = await database.ref('testResults')
                    .orderByChild('testId')
                    .equalTo(testId)
                    .once('value');

                const allResults = [];
                resultsSnapshot.forEach(childSnapshot => {
                    allResults.push(childSnapshot.val());
                });

                displayTestAnalysis(allResults);
            } catch (error) {
                console.error('Error loading test results:', error);
                alert('Error loading test results');
            }
        }

        function displayTestAnalysis(allResults) {
            // Show overview sections
            document.getElementById('testOverview').style.display = 'block';
            document.getElementById('studentPerformance').style.display = 'block';

            // Update test info
            document.getElementById('selectedTestTitle').textContent = selectedTestData.title;
            document.getElementById('testDate').textContent = `Date: ${new Date(selectedTestData.createdAt).toLocaleDateString()}`;
            document.getElementById('testDuration').textContent = `Duration: ${selectedTestData.duration} min`;

            // Group results by student
            const studentResults = {};
            allResults.forEach(result => {
                if (!studentResults[result.studentId]) {
                    studentResults[result.studentId] = {
                        studentName: result.studentName,
                        attempts: []
                    };
                }
                studentResults[result.studentId].attempts.push(result);
            });

            // Sort attempts by submission time for each student
            Object.values(studentResults).forEach(student => {
                student.attempts.sort((a, b) => a.submittedAt - b.submittedAt);
            });

            // Calculate statistics
            const totalStudents = Object.keys(studentResults).length;
            let liveAttempts = 0;
            let nonLiveAttempts = 0;
            let totalReattempts = 0;

            Object.values(studentResults).forEach(student => {
                student.attempts.forEach((attempt, index) => {
                    if (isAttemptLive(attempt)) {
                        liveAttempts++;
                    } else {
                        nonLiveAttempts++;
                    }
                    
                    if (index > 0) {
                        totalReattempts++;
                    }
                });
            });

            // Update overview stats
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('liveAttempts').textContent = liveAttempts;
            document.getElementById('nonLiveAttempts').textContent = nonLiveAttempts;
            document.getElementById('totalReattempts').textContent = totalReattempts;

            // Display student table
            displayStudentTable(studentResults);
        }

        function isAttemptLive(attempt) {
            if (!selectedTestData.startDateTime || !selectedTestData.endDateTime) return false;
            
            const attemptTime = new Date(attempt.submittedAt);
            const testStartTime = new Date(selectedTestData.startDateTime);
            const testEndTime = new Date(selectedTestData.endDateTime);
            
            return attemptTime >= testStartTime && attemptTime <= testEndTime;
        }

        function displayStudentTable(studentResults) {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';

            Object.entries(studentResults).forEach(([studentId, student]) => {
                const attempts = student.attempts;
                const attemptCount = attempts.length;
                
                // Calculate best, lowest, and latest scores
                const scores = attempts.map(attempt => Math.round((attempt.totalMarks / attempt.maxMarks) * 100));
                const bestScore = Math.max(...scores);
                const lowestScore = Math.min(...scores);
                const latestScore = scores[scores.length - 1];
                
                // Calculate total XP (first attempt + reattempts)
                let totalXP = 0;
                attempts.forEach((attempt, index) => {
                    if (index === 0) {
                        // First attempt gets full XP if LIVE
                        if (isAttemptLive(attempt)) {
                            totalXP += attempt.earnedXP || 0;
                        }
                    } else {
                        // Reattempts get 1 XP per correct if LIVE
                        if (isAttemptLive(attempt)) {
                            totalXP += attempt.correctAnswers || 0;
                        }
                    }
                });

                // Determine status
                const liveAttemptsCount = attempts.filter(attempt => isAttemptLive(attempt)).length;
                const nonLiveAttemptsCount = attemptCount - liveAttemptsCount;
                
                let statusBadge = '';
                if (liveAttemptsCount > 0 && nonLiveAttemptsCount === 0) {
                    statusBadge = `<div class="flex items-center justify-center">
                        <div class="bg-gradient-to-r from-emerald-100 to-emerald-200 text-emerald-800 px-3 py-2 rounded-xl text-xs font-bold flex items-center shadow-sm">
                            <svg class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.7088 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4905 2.02168 11.3363C2.16356 9.18203 2.99721 7.13214 4.39828 5.49883C5.79935 3.86553 7.69279 2.72636 9.79619 2.24223C11.8996 1.75809 14.1003 1.95185 16.07 2.79" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <polyline points="22,4 12,14.01 9,11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            All LIVE
                        </div>
                    </div>`;
                } else if (liveAttemptsCount === 0) {
                    statusBadge = `<div class="flex items-center justify-center">
                        <div class="bg-gradient-to-r from-red-100 to-red-200 text-red-800 px-3 py-2 rounded-xl text-xs font-bold flex items-center shadow-sm">
                            <svg class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
                                <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            All NON-LIVE
                        </div>
                    </div>`;
                } else {
                    statusBadge = `<div class="flex items-center justify-center">
                        <div class="bg-gradient-to-r from-amber-100 to-amber-200 text-amber-800 px-3 py-2 rounded-xl text-xs font-bold flex items-center shadow-sm">
                            <svg class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2"/>
                                <line x1="12" y1="16" x2="12.01" y2="16" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Mixed
                        </div>
                    </div>`;
                }

                const row = document.createElement('tr');
                row.className = 'hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50 transition-all duration-300 group';
                row.innerHTML = `
                    <td class="py-4 px-6">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mr-3 text-white font-bold text-sm">
                                ${student.studentName.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900 text-sm sm:text-base font-poppins">${student.studentName}</div>
                                <div class="text-xs sm:text-sm text-gray-500 flex items-center mt-1">
                                    <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-emerald-100 text-emerald-800 mr-2">
                                        ${liveAttemptsCount} LIVE
                                    </span>
                                    <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-red-100 text-red-800">
                                        ${nonLiveAttemptsCount} NON-LIVE
                                    </span>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="py-4 px-4 text-center">
                        <div class="text-lg sm:text-xl font-bold text-purple-600 font-poppins">${attemptCount}</div>
                        <div class="text-xs text-gray-500 hidden sm:block font-medium">${attemptCount > 1 ? (attemptCount - 1) + ' reattempts' : 'First attempt'}</div>
                    </td>
                    <td class="py-4 px-4 text-center">
                        <div class="text-lg sm:text-xl font-bold text-emerald-600 font-poppins">${bestScore}%</div>
                        <div class="text-xs text-gray-500 hidden sm:block font-medium">${Math.round((bestScore / 100) * selectedTestData.totalMarks)} marks</div>
                    </td>
                    <td class="py-4 px-4 text-center">
                        <div class="text-lg sm:text-xl font-bold text-red-600 font-poppins">${lowestScore}%</div>
                        <div class="text-xs text-gray-500 hidden sm:block font-medium">${Math.round((lowestScore / 100) * selectedTestData.totalMarks)} marks</div>
                    </td>
                    <td class="py-4 px-4 text-center">
                        <div class="text-lg sm:text-xl font-bold text-blue-600 font-poppins">${latestScore}%</div>
                        <div class="text-xs text-gray-500 hidden sm:block font-medium">${Math.round((latestScore / 100) * selectedTestData.totalMarks)} marks</div>
                    </td>
                    <td class="py-4 px-4 text-center">
                        ${statusBadge}
                    </td>
                    <td class="py-4 px-4 text-center">
                        <div class="flex items-center justify-center">
                            <div class="bg-gradient-to-r from-amber-100 to-amber-200 text-amber-800 px-3 py-2 rounded-xl flex items-center shadow-sm">
                                <svg class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span class="text-lg font-bold font-poppins">${totalXP}</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 hidden sm:block font-medium mt-1">Total XP</div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });

            // Sort table by attempt count (descending)
            const rows = Array.from(tbody.children);
            rows.sort((a, b) => {
                const aAttempts = parseInt(a.children[1].children[0].textContent);
                const bAttempts = parseInt(b.children[1].children[0].textContent);
                return bAttempts - aAttempts;
            });
            
            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
        }
    </script>
</body>
</html>