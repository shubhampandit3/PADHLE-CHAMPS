<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Leaderboard - Padhle Champs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        * { font-family: 'Inter', sans-serif; }
        .font-poppins { font-family: 'Poppins', sans-serif; }
        
        .gradient-bg { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .gradient-text { background: linear-gradient(135deg, #f093fb, #f5576c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .leaderboard-item {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        
        .leaderboard-item:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.15);
        }
        
        .trophy-gold { 
            background: linear-gradient(135deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .trophy-silver { 
            background: linear-gradient(135deg, #C0C0C0, #A8A8A8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .trophy-bronze { 
            background: linear-gradient(135deg, #CD7F32, #B8860B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .animate-fade-in { animation: fadeIn 0.8s ease-out forwards; }
        .animate-slide-up { animation: slideUp 0.6s ease-out forwards; }
        .animate-bounce-in { animation: bounceIn 0.8s ease-out forwards; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounceIn { 
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .floating-trophy { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-15px); } }
        
        .pulse-ring { animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite; }
        @keyframes pulse-ring { 0% { transform: scale(0.33); } 80%, 100% { opacity: 0; } }
        
        .shimmer { animation: shimmer 2s linear infinite; }
        @keyframes shimmer { 0% { background-position: -200px 0; } 100% { background-position: calc(200px + 100%) 0; } }
        
        .rank-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }
        
        .user-highlight {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1), rgba(245, 87, 108, 0.1));
            border: 2px solid rgba(240, 147, 251, 0.3);
        }
        
        @media (max-width: 640px) {
            .leaderboard-item:hover { transform: none; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 min-h-screen">
    <!-- Background Pattern -->
    <div class="fixed inset-0 opacity-5 pointer-events-none">
        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <pattern id="trophy-pattern" width="60" height="60" patternUnits="userSpaceOnUse">
                    <circle cx="30" cy="30" r="2" fill="#f093fb" opacity="0.3"/>
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#trophy-pattern)"/>
        </svg>
    </div>

    <!-- Header -->
    <nav class="gradient-bg shadow-2xl relative overflow-hidden">
        <div class="absolute inset-0 bg-black bg-opacity-10"></div>
        <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between h-14 sm:h-16 lg:h-20">
                <div class="flex items-center gap-2 sm:gap-3 lg:gap-4 flex-1 min-w-0">
                    <button onclick="window.history.back()" class="p-1.5 sm:p-2 lg:p-3 hover:bg-white hover:bg-opacity-20 rounded-lg sm:rounded-xl transition-all duration-300 group flex-shrink-0">
                        <span class="material-icons text-white group-hover:scale-110 transition-transform text-lg sm:text-xl lg:text-2xl">arrow_back</span>
                    </button>
                    <div class="flex items-center gap-2 sm:gap-3 lg:gap-4 min-w-0">
                        <div class="relative flex-shrink-0">
                            <div class="w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 bg-white bg-opacity-20 rounded-xl sm:rounded-2xl flex items-center justify-center floating-trophy">
                                <span class="material-icons text-white text-base sm:text-xl lg:text-2xl">emoji_events</span>
                            </div>
                            <div class="absolute -inset-1 sm:-inset-2 bg-white bg-opacity-20 rounded-xl sm:rounded-2xl pulse-ring"></div>
                        </div>
                        <div class="min-w-0">
                            <h1 class="text-sm sm:text-lg lg:text-xl xl:text-2xl font-bold text-white font-poppins truncate">Test Leaderboard</h1>
                            <p class="text-xs sm:text-sm text-white text-opacity-90 font-medium hidden sm:block">Compete and excel together</p>
                        </div>
                    </div>
                </div>
                <div class="glass-effect px-2 sm:px-3 lg:px-4 py-1.5 sm:py-2 rounded-lg sm:rounded-xl flex-shrink-0">
                    <div class="flex items-center gap-1 sm:gap-2">
                        <span class="material-icons text-white text-sm sm:text-base">person</span>
                        <span class="font-semibold text-white text-xs sm:text-sm lg:text-base truncate max-w-20 sm:max-w-none" id="username">Student</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-12">
        <!-- Test Selection Section -->
        <div class="glass-effect rounded-3xl shadow-2xl p-6 sm:p-8 mb-8 sm:mb-12 animate-fade-in">
            <div class="flex flex-col sm:flex-row sm:items-center gap-4 sm:gap-6 mb-6 sm:mb-8">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 sm:w-16 sm:h-16 gradient-bg rounded-2xl flex items-center justify-center shadow-xl">
                        <span class="material-icons text-white text-2xl sm:text-3xl">assignment</span>
                    </div>
                    <div>
                        <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold gradient-text font-poppins">Select Test</h2>
                        <p class="text-sm sm:text-base text-slate-600 font-medium">Choose a test to view rankings and performance</p>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col lg:flex-row gap-4 lg:gap-6">
                <div class="flex-1">
                    <label class="block text-sm font-semibold text-slate-700 mb-3">Available Tests</label>
                    <div class="relative">
                        <select id="testDropdown" class="w-full px-4 sm:px-6 py-3 sm:py-4 bg-white/80 border-2 border-slate-200 rounded-2xl focus:ring-4 focus:ring-pink-100 focus:border-pink-400 transition-all text-sm sm:text-base lg:text-lg font-medium shadow-lg">
                            <option value="">üèÜ Choose a test to view leaderboard...</option>
                        </select>
                        <span class="material-icons absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 pointer-events-none">expand_more</span>
                    </div>
                </div>
                <div class="lg:flex-none">
                    <label class="block text-sm font-semibold text-slate-700 mb-3 lg:opacity-0">Action</label>
                    <button onclick="loadLeaderboard()" class="w-full lg:w-auto gradient-bg text-white px-6 sm:px-8 py-3 sm:py-4 rounded-2xl font-semibold text-sm sm:text-base lg:text-lg shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105 flex items-center justify-center gap-2">
                        <span class="material-icons">emoji_events</span>
                        View Leaderboard
                    </button>
                </div>
            </div>
        </div>

        <!-- Test Results Section -->
        <div id="testResults" class="hidden space-y-6 sm:space-y-8">
            <!-- Test Header -->
            <div class="glass-effect rounded-3xl shadow-2xl p-6 sm:p-8 text-center animate-bounce-in">
                <div class="relative inline-block mb-6">
                    <div class="w-20 h-20 sm:w-24 sm:h-24 gradient-bg rounded-3xl flex items-center justify-center mx-auto shadow-2xl floating-trophy">
                        <span class="material-icons text-white text-4xl sm:text-5xl">emoji_events</span>
                    </div>
                    <div class="absolute -inset-4 gradient-bg rounded-3xl opacity-20 pulse-ring"></div>
                </div>
                <h3 class="text-2xl sm:text-3xl lg:text-4xl font-bold gradient-text mb-3 font-poppins" id="testTitle">Test Leaderboard</h3>
                <div class="flex items-center justify-center gap-2 text-base sm:text-lg text-slate-600 font-medium">
                    <span class="material-icons text-slate-600">groups</span>
                    <span id="totalParticipants">0 participants</span>
                </div>
            </div>
            
            <!-- Your Rank Card -->
            <div id="userRankCard" class="gradient-bg rounded-3xl p-6 sm:p-8 text-white shadow-2xl animate-slide-up">
                <div class="flex flex-col lg:flex-row items-center justify-between gap-6">
                    <div class="text-center lg:text-left">
                        <div class="flex items-center justify-center lg:justify-start gap-3 mb-4">
                            <span class="material-icons text-2xl sm:text-3xl">emoji_events</span>
                            <h4 class="text-xl sm:text-2xl font-bold font-poppins">Your Position</h4>
                        </div>
                        <div class="flex flex-col sm:flex-row items-center justify-center lg:justify-start gap-4 sm:gap-8">
                            <div class="text-center">
                                <div class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-2" id="userRank">#-</div>
                                <div class="text-sm sm:text-base opacity-90">Rank</div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 sm:gap-6 text-center">
                                <div>
                                    <div class="text-lg sm:text-xl font-bold" id="userScore">-</div>
                                    <div class="text-xs sm:text-sm opacity-90">Score</div>
                                </div>
                                <div>
                                    <div class="text-lg sm:text-xl font-bold" id="userTime">-</div>
                                    <div class="text-xs sm:text-sm opacity-90">Time</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center lg:text-right">
                        <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl px-4 sm:px-6 py-3 sm:py-4">
                            <div class="text-base sm:text-lg font-semibold" id="rankMessage">Not attempted yet</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top 10 Leaderboard -->
            <div class="glass-effect rounded-3xl shadow-2xl p-6 sm:p-8 animate-slide-up">
                <div class="text-center mb-8">
                    <h4 class="text-2xl sm:text-3xl font-bold gradient-text mb-2 font-poppins">üèÜ Top 10 Performers</h4>
                    <p class="text-slate-600 font-medium">First attempts only ‚Ä¢ Ranked by score and time</p>
                </div>
                <div class="space-y-4 sm:space-y-6" id="leaderboardList">
                    <!-- Leaderboard items will be populated here -->
                </div>
            </div>
        </div>

        <!-- No Results State -->
        <div id="noResults" class="hidden glass-effect rounded-3xl shadow-2xl p-8 sm:p-12 text-center animate-bounce-in">
            <div class="relative inline-block mb-8">
                <span class="material-icons text-slate-300 text-8xl sm:text-9xl">search_off</span>
            </div>
            <h3 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-4 font-poppins">No Results Found</h3>
            <p class="text-slate-600 text-base sm:text-lg mb-6">This test hasn't been attempted by anyone yet. Be the first to take it!</p>
            <button onclick="resetSelection()" class="gradient-bg text-white px-6 py-3 rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all">
                Choose Another Test
            </button>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden glass-effect rounded-3xl shadow-2xl p-8 sm:p-12 text-center">
            <div class="relative inline-block mb-8">
                <svg class="w-16 h-16 sm:w-20 sm:h-20 text-pink-400 animate-spin" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-dasharray="31.416" stroke-dashoffset="31.416">
                        <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
                        <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
                    </circle>
                </svg>
            </div>
            <h3 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-4 font-poppins">Loading Leaderboard</h3>
            <p class="text-slate-600 text-base sm:text-lg">Fetching rankings and calculating positions...</p>
        </div>

        <!-- Initial State -->
        <div id="initialState" class="glass-effect rounded-3xl shadow-2xl p-8 sm:p-12 text-center animate-fade-in">
            <div class="relative inline-block mb-8">
                <div class="w-24 h-24 sm:w-32 sm:h-32 gradient-bg rounded-3xl flex items-center justify-center mx-auto shadow-2xl floating-trophy">
                    <span class="material-icons text-white text-6xl sm:text-7xl">emoji_events</span>
                </div>
                <div class="absolute -inset-6 gradient-bg rounded-3xl opacity-20 pulse-ring"></div>
            </div>
            <h3 class="text-3xl sm:text-4xl font-bold gradient-text mb-4 font-poppins">Ready to See Rankings?</h3>
            <p class="text-slate-600 text-base sm:text-lg lg:text-xl mb-8 max-w-2xl mx-auto leading-relaxed">Choose a test from the dropdown above to view the leaderboard and see where you rank among your peers!</p>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 max-w-2xl mx-auto">
                <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 border border-yellow-200 rounded-2xl p-4 text-center">
                    <span class="material-icons text-yellow-600 text-3xl mx-auto mb-2">military_tech</span>
                    <div class="text-sm font-semibold text-yellow-800">First Attempts</div>
                </div>
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-2xl p-4 text-center">
                    <span class="material-icons text-blue-600 text-3xl mx-auto mb-2">schedule</span>
                    <div class="text-sm font-semibold text-blue-800">Time-Based</div>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-2xl p-4 text-center">
                    <span class="material-icons text-green-600 text-3xl mx-auto mb-2">groups</span>
                    <div class="text-sm font-semibold text-green-800">Top 10 Display</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCDZJeZeJPkuDUZ5Vf_-rsy0PQsx8tQw4k",
            authDomain: "quiz-app-10f81.firebaseapp.com",
            databaseURL: "https://quiz-app-10f81-default-rtdb.firebaseio.com",
            projectId: "quiz-app-10f81",
            storageBucket: "quiz-app-10f81.firebasestorage.app",
            messagingSenderId: "351578019731",
            appId: "1:351578019731:web:2055fe24498ca17908fa66"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let currentUser = null;

        document.addEventListener('DOMContentLoaded', function() {
            const userData = localStorage.getItem('padhleChamps_user');
            if (userData) {
                const user = JSON.parse(userData);
                currentUser = { uid: user.userId || user.name };
                document.getElementById('username').textContent = user.name.split(' ')[0];
                loadAvailableTests();
            } else {
                window.location.href = 'login.html';
            }
        });

        async function loadAvailableTests() {
            try {
                const snapshot = await database.ref('tests').once('value');
                const tests = snapshot.val() || {};
                
                const dropdown = document.getElementById('testDropdown');
                dropdown.innerHTML = '<option value="">üèÜ Choose a test to view leaderboard...</option>';
                
                Object.entries(tests).forEach(([testId, test]) => {
                    const option = document.createElement('option');
                    option.value = testId;
                    option.textContent = `üìù ${test.title}`;
                    dropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading tests:', error);
                showToast('Error loading tests. Please refresh the page.', 'error');
            }
        }

        async function loadLeaderboard() {
            const selectedTestId = document.getElementById('testDropdown').value;
            if (!selectedTestId) {
                showToast('Please select a test first!', 'warning');
                return;
            }

            showState('loading');

            try {
                const testSnapshot = await database.ref(`tests/${selectedTestId}`).once('value');
                const testData = testSnapshot.val();
                
                if (!testData) {
                    showState('noResults');
                    return;
                }

                const resultsSnapshot = await database.ref('testResults').once('value');
                const allResults = resultsSnapshot.val() || {};
                
                let matchingResults = [];
                Object.keys(allResults).forEach(resultId => {
                    const result = allResults[resultId];
                    if (result.testId === selectedTestId) {
                        matchingResults.push({ resultId, ...result });
                    }
                });

                if (matchingResults.length === 0) {
                    showState('noResults');
                    return;
                }

                await displayLeaderboard(matchingResults, testData.title);

            } catch (error) {
                console.error('Error loading leaderboard:', error);
                showState('noResults');
                showToast('Error loading leaderboard. Please try again.', 'error');
            }
        }

        async function displayLeaderboard(results, testTitle) {
            const userFirstAttempts = {};
            
            results.forEach(result => {
                const userId = result.studentId || result.userId;
                const attemptNum = result.attemptNumber || 1;
                
                if (!userFirstAttempts[userId] && attemptNum === 1) {
                    userFirstAttempts[userId] = result;
                }
            });

            const sortedResults = Object.values(userFirstAttempts).sort((a, b) => {
                if (b.totalMarks !== a.totalMarks) return b.totalMarks - a.totalMarks;
                return (a.timeTaken || 0) - (b.timeTaken || 0);
            });

            document.getElementById('testTitle').textContent = testTitle;
            document.getElementById('totalParticipants').textContent = `${sortedResults.length} participants`;

            const userRank = sortedResults.findIndex(r => (r.studentId || r.userId) === currentUser.uid || r.studentName === currentUser.uid) + 1;
            const userResult = sortedResults.find(r => (r.studentId || r.userId) === currentUser.uid || r.studentName === currentUser.uid);

            if (userResult) {
                document.getElementById('userRank').textContent = `#${userRank}`;
                document.getElementById('userScore').textContent = `${userResult.totalMarks}/${userResult.maxMarks}`;
                document.getElementById('userTime').textContent = formatTime(userResult.timeTaken || 0);
                
                let message = 'Great job!';
                if (userRank === 1) message = 'üèÜ Champion!';
                else if (userRank <= 3) message = 'ü•â Top 3!';
                else if (userRank <= 5) message = '‚≠ê Top 5!';
                else if (userRank <= 10) message = 'üëç Top 10!';
                
                document.getElementById('rankMessage').textContent = message;
            } else {
                document.getElementById('userRank').textContent = '#-';
                document.getElementById('userScore').textContent = '-';
                document.getElementById('userTime').textContent = '-';
                document.getElementById('rankMessage').textContent = 'Not attempted yet';
            }

            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '';

            sortedResults.slice(0, 10).forEach((result, index) => {
                const rank = index + 1;
                const userId = result.studentId || result.userId;
                const isCurrentUser = userId === currentUser.uid || result.studentName === currentUser.uid;
                
                const item = document.createElement('div');
                item.className = `leaderboard-item flex flex-col sm:flex-row items-center justify-between p-4 sm:p-6 rounded-2xl sm:rounded-3xl border-2 ${
                    isCurrentUser ? 'user-highlight' : 'bg-white/80 border-slate-200'
                } shadow-lg hover:shadow-2xl transition-all duration-300`;
                item.style.animationDelay = `${index * 0.1}s`;
                item.classList.add('animate-slide-up');
                
                let rankDisplay, rankBadge;
                if (rank === 1) {
                    rankDisplay = `
                        <div class="relative">
                            <span class="material-icons text-5xl sm:text-6xl trophy-gold">emoji_events</span>
                            <div class="absolute -inset-2 bg-gradient-to-r from-yellow-400 to-orange-400 rounded-full opacity-20 pulse-ring"></div>
                        </div>
                    `;
                    rankBadge = 'üèÜ Champion';
                } else if (rank === 2) {
                    rankDisplay = `
                        <span class="material-icons text-5xl sm:text-6xl trophy-silver">emoji_events</span>
                    `;
                    rankBadge = 'ü•à Runner-up';
                } else if (rank === 3) {
                    rankDisplay = `
                        <span class="material-icons text-5xl sm:text-6xl trophy-bronze">emoji_events</span>
                    `;
                    rankBadge = 'ü•â Third Place';
                } else {
                    rankDisplay = `<div class="w-12 h-12 sm:w-16 sm:h-16 rank-badge rounded-2xl flex items-center justify-center text-white font-bold text-lg sm:text-xl">${rank}</div>`;
                    rankBadge = rank <= 5 ? '‚≠ê Top 5' : 'üëç Top 10';
                }

                const percentage = ((result.totalMarks / result.maxMarks) * 100).toFixed(1);
                const userName = result.studentName || result.userName || 'Unknown User';
                
                item.innerHTML = `
                    <div class="flex items-center gap-4 sm:gap-6 w-full sm:w-auto mb-4 sm:mb-0">
                        <div class="text-center flex-shrink-0">${rankDisplay}</div>
                        <div class="flex-1 min-w-0">
                            <div class="flex flex-col sm:flex-row sm:items-center gap-2 mb-3">
                                <h4 class="text-lg sm:text-xl font-bold ${isCurrentUser ? 'gradient-text' : 'text-slate-900'} font-poppins truncate">
                                    ${userName}
                                </h4>
                                ${isCurrentUser ? '<span class="bg-gradient-to-r from-pink-100 to-purple-100 text-pink-800 px-3 py-1 rounded-full text-xs font-bold">YOU</span>' : ''}
                            </div>
                            <div class="grid grid-cols-2 sm:flex sm:items-center gap-3 sm:gap-6 text-xs sm:text-sm text-slate-600">
                                <div class="flex items-center gap-2">
                                    <span class="material-icons text-green-500 text-base">check_circle</span>
                                    <span class="font-semibold">${result.totalMarks}/${result.maxMarks}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="material-icons text-blue-500 text-base">schedule</span>
                                    <span class="font-semibold">${formatTime(result.timeTaken || 0)}</span>
                                </div>
                                <div class="flex items-center gap-2 col-span-2 sm:col-span-1">
                                    <span class="material-icons text-purple-500 text-base">done_all</span>
                                    <span class="font-semibold">${result.correctAnswers} correct</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center sm:text-right flex-shrink-0">
                        <div class="text-2xl sm:text-3xl font-bold ${isCurrentUser ? 'gradient-text' : 'text-slate-700'} mb-1 font-poppins">
                            ${percentage}%
                        </div>
                        <div class="text-xs sm:text-sm font-semibold text-slate-500">
                            ${rankBadge}
                        </div>
                    </div>
                `;
                
                leaderboardList.appendChild(item);
            });

            showState('results');
        }

        function showState(state) {
            const states = ['initialState', 'loadingState', 'testResults', 'noResults'];
            states.forEach(s => {
                const element = document.getElementById(s);
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            const targetElement = document.getElementById(state === 'results' ? 'testResults' : state);
            if (targetElement) {
                targetElement.classList.remove('hidden');
            }
        }

        function resetSelection() {
            document.getElementById('testDropdown').value = '';
            showState('initialState');
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'error' ? 'bg-red-500' : type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-xl shadow-lg z-50 animate-slide-up`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }

        document.getElementById('testDropdown').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') loadLeaderboard();
        });
        
        document.getElementById('testDropdown').addEventListener('change', function() {
            if (this.value) setTimeout(() => loadLeaderboard(), 300);
        });
    </script>
</body>
</html>